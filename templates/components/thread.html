{% if replies %}
<div class="thread-replies">
    {% for reply in replies %}
    <div class="thread-reply">
        <div class="message-avatar">
            {% if reply.avatar_local %}
                <img src="{{ url_for('media', filepath=reply.avatar_local) }}" alt="{{ reply.display_name or reply.user_name or 'User' }}" class="avatar-img">
            {% else %}
                <div class="avatar-placeholder">{{ (reply.display_name or reply.user_name or 'U')[0] | upper }}</div>
            {% endif %}
        </div>
        <div class="message-content">
            <div class="message-header">
                <span class="message-author">{{ reply.display_name or reply.user_name or 'Unknown' }}</span>
                <span class="message-time">{{ reply.formatted_time }}</span>
            </div>
            <div class="message-text">{{ reply.formatted_text | safe }}</div>

            {% if reply.files %}
            <div class="message-files">
                {% for file in reply.files %}
                    {% if file.local_path and file.mimetype and file.mimetype.startswith('image/') %}
                        <div class="file-preview">
                            <img src="{{ url_for('media', filepath=file.local_path) }}" alt="{{ file.name }}" class="file-image">
                        </div>
                    {% elif file.local_path %}
                        <div class="file-attachment">
                            <div class="file-icon">ðŸ“Ž</div>
                            <div class="file-info">
                                <a href="{{ url_for('media', filepath=file.local_path) }}" class="file-name" download>{{ file.name }}</a>
                                <span class="file-type">{{ file.mimetype or 'File' }}</span>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            {% if reply.reactions %}
            <div class="message-reactions">
                {% for reaction in reply.reactions %}
                    <span class="reaction">
                        <span class="reaction-emoji">:{{ reaction.name }}:</span>
                        <span class="reaction-count">{{ reaction.count }}</span>
                    </span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="thread-empty">No replies in this thread.</div>
{% endif %}
